
<div align="center" > 
  
# QuikSplit

### Quickly split bills with anyone just by taking a photo of the receipt!

[View the live project here](https://kwik-split.herokuapp.com/)

</div>

<img align="right" src="https://user-images.githubusercontent.com/69271605/215595966-d5264d7b-0d38-438a-89cc-8b4b51ae0cad.png" > 


<div align="left">

**[Introduction](#introduction)**<br>
**[Technologies used](#technologies-used)**<br>
**[Design](#design)**<br>
**[User Experience (UX)](#user-experience-ux)**<br>
**[Testing](#testing)**<br>
**[Deployment](#deployment)**<br>
**[Credits](#credits)**<br>
 
</div>

## Introduction

This project is for the milestone project 4 of the Code Institutes Full Stack Developer Course, this Application will allow a user to take a photo of a recipt or invoice and split the costs with other users. A good example of where this would be useful is for dinner out with friends, or for on-going expenses while on a group holiday, or even for work expenses.

A recipt is processed using google clouds Document AI and then the resulting line items can be assigned to different users. The user can create, read, update and delete the expense records and their profile information. Users payouts are processed by stripe using the connect service. Each account is onboarded, where their bank account and identification information is confirmed to reduce financial loss and increase security. 
  


## Technologies used
  #### Front End
    - Material Design for Bootstrap (MDB)
    - HTML
    - Fontawesome icons
    - In product help/guide - Tourguide.js
    - Custom CSS
    - Django Templating
  #### Back End  
    - Django
    - Python
    - AWS S3 storage
    - Heroku
    - Elephant SQL
    - Google Cloud Document AI

## Design

The initial site design was mocked up in Miro across three different screen sizes; mobile, tablet and desktop. The site was designed as mobile first and responsive and scaled to other screen sizes where needed usign media queries and by un-stacking columns above the XL breakpoint. 

The breakpoint were set to the 6 default MDB breakpoints:

<table class="table table-striped">
      <thead>
        <tr>
          <th>Breakpoint</th>
          <th>Class infix</th>
          <th>Dimensions</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>X-Small</td>
          <td><em>None</em></td>
          <td>0–576px</td>
        </tr>
        <tr>
          <td>Small</td>
          <td><code>sm</code></td>
          <td>≥576px</td>
        </tr>
        <tr>
          <td>Medium</td>
          <td><code>md</code></td>
          <td>≥768px</td>
        </tr>
        <tr>
          <td>Large</td>
          <td><code>lg</code></td>
          <td>≥992px</td>
        </tr>
        <tr>
          <td>Extra large</td>
          <td><code>xl</code></td>
          <td>≥1200px</td>
        </tr>
        <tr>
          <td>Extra extra large</td>
          <td><code>xxl</code></td>
          <td>≥1400px</td>
        </tr>
      </tbody>
    </table>

------

## User experience (UX)

The site was designed with a responsive top navigation bar which displayed the log in/out buttons and links to the home page and the users home page.

### User Stories

The site was designed as a web app in which the user can easily split a bill with another user. Some high-level user stories were developed at the start of the project to define which features to implement:

- As a user, I want to be able to search for and follow other users, so I can split a bill with them.
- As a user, I want to be able to update my profile information.
- As a user, I want to be able to calculate a bill amount, so that I can request payment.
- As a user, I want to be able to easily split a bill with other users.
- As a user, I want a history of all of my payments, so I can see what I've spent.
- As a user, I want a history of all of my requests, so I can see whats been sent to me.

The app was developed with these in mind along with some technical requirements for the application, onboarding and payment flows to be secure.

### Colours
I chose complimentry colours generated by using [Coolors](https://coolors.co/) and the colour calculator at https://www.sessions.edu/color-calculator/

![Colours](https://user-images.githubusercontent.com/69271605/215583361-4927e807-98fb-4fb0-839d-5f5eaeffb41a.png)

### Icons
All icons are from font-awesome

### Initial Wire-frames

I created a number of wire-frames as a part of the project development to inform the design as I worked, these were updated as the project progressed and I had more familiarity with the CSS/component library in use, MDB. Initial low fidelity wireframes were made for mobile, tablet and desktop:

![image](https://user-images.githubusercontent.com/69271605/215562551-ba6b7d0e-af31-439c-8165-eba228a64134.png)

The wire-frames were shown as mobile first and expanded on for larger screen sizes where component layouts would be changed. I thought the most important interfaces were the users home page and where the user uploaded new expenses.

![image](https://user-images.githubusercontent.com/69271605/215555517-792dab64-5a4b-4c88-883a-2c1af28c1840.png) ![image](https://user-images.githubusercontent.com/69271605/215555749-dfe0e277-c157-435b-961a-b17f2364c02c.png)


### Product Tour

I provided an interactive tour on the users homepage and the page in which you define an expense. The tour is intiated by a floating button on the page which then explains the features of the page and how to use the app.

The library used was tourguide.js, it was set up by adding data attributes to the html elements which defined the position in the product tour and the title and message for each of the elements covered in the tour.

### User interfaces

The users manage their requested payments and payouts through this tab interface on their home page:
![image](https://user-images.githubusercontent.com/69271605/215558285-a35c28f9-ecd1-478d-85a3-833dd37ac7bc.png)

Each of the expenses details is shown on the accordian face and each of the line items was shown on the inside of it when expanded:
![image](https://user-images.githubusercontent.com/69271605/215559018-336796f3-f64e-4853-ae4d-b20053110352.png)

------

## Testing

Testing for the project was a manual process in which I performed functional and user acceptance testing on the application. I used in-browser testing tools to check for the functional requirements such as adequate loading times, accessability, html and CSS linting etc. I then performed User acceptance testing by manually testing each flow in the app to ensure that it works as expected from a users perspective the deliver the user stories. I have further documented the testing work undertaken in the [TESTING.md](TESTING.md) file located in this repository.

Below, I have outlined the identification and bank account details needed in order to test the third party stripe onboarding and payment flows in which the user is taken away from the app domain to stripe and then returned once completed either successfully or unsuccessfully.

### Stripe Connect

Stripe connect is currently in developer/testing mode so that user information doesnt have to be handled and verified. When a user in onboarded, they are redirected to a URL generated by stripe which then guides them through the onboarding process. A user has to confirm their phone number to receive a verification code, their identity and bank account for payouts. For testing, different information can be input to generate dofferent HTTP responses, the input data will be defined below:

#### Test dates of birth
Use these dates of birth (DOB) to trigger certain verification conditions.

<table><thead><tr><th style="width: 200px;">DOB</th><th style="width: 900px;">Type</th></tr></thead><tbody><tr><td><code>1901-01-01</code></td><td>Successful verification. Any other DOB results in unsuccessful verification.</td></tr><tr><td><code>1902-01-01</code></td><td>Successful, immediate verification. The verification result is returned directly in the response, not as part of a <span><span><a title="webhook" class="UnstyledLink InlineLink Text-color--blue Glossary-term no-api-tag" href="/docs/webhooks">webhook</a></span></span> event.</td></tr><tr><td><code >1900-01-01</code></td><td>This DOB triggers an Office of Foreign Assets Control (OFAC) alert.</td></tr></tbody></table>

#### Trigger bank account ownership verification

<div class="Table Table--striped Box-root Padding-vertical--12" style="position:relative"><table><thead><tr><th style="width: 118px;">Routing</th><th style="width: 141px;">Account</th><th style="width: 569px;">Type</th></tr></thead><tbody><tr><td><code class="InlineCode">110000000</code></td><td><code class="InlineCode">000999999991</code></td><td>Triggers the bank account ownership verification process after a short delay</td></tr></tbody></table></div>

#### Simulate requirements
If your platform has connected accounts in different countries or plans to, you might need to verify a person’s address as well as their identity (depending on the country). Stripe provides a sample date of birth (DOB) and sample addresses to test for this requirement.

<div class="Table Table--striped Box-root Padding-vertical--12" style="position:relative"><table><thead><tr><th style="width: 260px;">Information provided</th><th style="width: 186px;">Person verification status</th><th style="width: 382px;">requirements[currently_due]</th></tr></thead><tbody><tr><td>Verified date of birth and verified address</td><td>Verified</td><td>None</td></tr><tr><td>Verified date of birth and unverified address</td><td>Unverified</td><td><code class="InlineCode">verification.additional_document</code></td></tr><tr><td>Unverified date of birth and verified address</td><td>Unverified</td><td><code class="InlineCode">verification.document</code></td></tr><tr><td>Unverified date of birth and unverified address</td><td>Unverified</td><td><code class="InlineCode">verification.additional_document</code>, <code class="InlineCode">verification.document</code></td></tr></tbody></table></div>

The app is currently set to development model in stripe so that users can onboard without having to provide sensitive documents and bank account information. The stripe onboarding screen indicates its in test mode and you can click to use the test documents they provide.

------

## Deployment

The application is uses a number of third party services, libraries and API's which need to be set up individually in order to deploy the application. To get started clone a copy of this repo, if you do not know how to do this refer to this [git-guide](https://github.com/git-guides/git-clone). Once you have the project open in your IDE, run the command 
`pip install -r requirements.txt` in the terminal to install the required packages.

To configure the project to run you'll need to change the django settings and some environment variables. Ive used the python dotenv library to assist with this locally, an example .env file is shown below, this should be placed in the root of your project:

![env file - blanked](https://user-images.githubusercontent.com/69271605/215585076-5409fa60-9206-4507-9252-91ff1e33dd03.png)

There are a few different variables which can be set to have the project run locally or when deployed. if USE_AWS is set then the projects media and static files will refer to the files available on AWS, these can be updated by running `python3 manage.py collectstatic` to push your files to the platform.
if DEVELOPMENT is set then django will report verbose errors to the user, which is useful for development but should be unset in deployment. New users are required to confirm their email addresses by opening a link emailed to them, with DEVELOPMENT set the email will be displayed on the console as a SMPT mail server wont work until its deployed.

### AWS S3 storage

You'll have to sign up for Amazon S3 storage and create a storage bucket for the project, follow the steps in [this guide](https://docs.aws.amazon.com/AmazonS3/latest/userguide/GetStartedWithS3.html) until you have a bucket set up.

Currently the S3 storage is set to public and has the following bucket policy:
```
{
    "Version": "2012-10-17",
    "Id": "Policy1672490493654",
    "Statement": [
        {
            "Sid": "Stmt1672490490957",
            "Effect": "Allow",
            "Principal": "*",
            "Action": "s3:*",
            "Resource": [
                "arn:aws:s3:::kwik-split/*",
                "arn:aws:s3:::kwik-split"
            ]
        }
    ]
}
```

The CORS settings should be as follows:

```
[
    {
        "AllowedHeaders": [
            "Authorization"
        ],
        "AllowedMethods": [
            "GET"
        ],
        "AllowedOrigins": [
            "*"
        ],
        "ExposeHeaders": []
    }
]
```

it should be noted that if users intend to use the site in a production environment that this would eed to be changed to ensure user document remain private.

### Heroku

I would reccommend using the [Heroku CLI](https://devcenter.heroku.com/articles/heroku-cli) to publish the project to Heroku. When trying to login into the CLI you may be prompted to open a browser to login, if this doesnt work for you you can request to login through the terminal instead using `heroku login -i`. I had to enable 2 build packs in order for the project to run, the officially supported Heroku/Python build pack and one for to generate [google credentials](https://github.com/buyersight/heroku-google-application-credentials-buildpack.git) at runtime for the project.

### Elephant SQL

A database was set up in elephant SQL, follow the [guide](https://www.elephantsql.com/docs/) to create a database, when creating the database choose the tiny turtle plan which is free and should be suitable for our needs. take note of the database url as well be entering this into the application environment variables in Heroku

### Google Cloud Document AI

The project used the Document AI Python Client Library, to set up Google Cloud for the project navigate to your google account dashboard and follow the steps in this [guide](https://cloud.google.com/document-ai/docs/setup?hl=en) to generate service credentials and make sure you have billing enabled for the account. When you finish the set up, download your credentials JSON file, this will be used further down.

You'll then need to create the type of processor, for this project I've used the [expense parser](https://cloud.google.com/document-ai/docs/processors-list?hl=en#processor_expense-parser), this can be enabled in the document AI service library:

![image](https://user-images.githubusercontent.com/69271605/215590618-8be73bcb-70c9-445d-adca-1a008fbab086.png)


Youll need to copy the processor id, location and project id into the environment variables, the credentials process is slightly different depending on wether youre in the local or deployed environment:
```
DOCUMENT_AI_LOCATION
DOCUMENT_AI_PROCESSOR_ID
DOCUMENT_AI_PROJECT_ID
```
#### Local Development

Import your google credentials JSON file into the root directory of your project, from there reference it into the [expenses views.py file](https://github.com/NicoBrown/Milestone-4/blob/main/expenses/views.py#L31) location and uncomment it to enable the credentials.

#### Deployment

To deploy the app on Heroku, you need to set a variable with the `GOOGLE_APPLICATION_CREDENTIALS` set to `google-credentials.json`.
A variable called `GOOGLE_CREDENTIALS` should contain the contents of the JSON credentials file that was downloaded inside of it. In addition to this a Heroku build pack is required to parse the environment variables into a credential file as detailed in the heroku section above.

I would reccommend that you mock the server data if you intend to do further development or to trouble shoot problems due to the cost involved with repetitive API calls to the API.

### Google email

A Google mail account is used to send emails to new users, a good guide to setting up 2FA and enabling an application is available [here](https://www.abstractapi.com/guides/django-send-email), once you have generated an the required credentials input them into the environment variables for the EMAIL_HOST_USER, EMAIL_HOST_PASSWORD and DEFAULT_FROM_EMAIL, these are then used in the settings.py file:
```
if 'DEVELOPMENT' in os.environ:
    EMAIL_BACKEND = 'django.core.mail.backends.console.EmailBackend'
    DEFAULT_FROM_EMAIL = 'kwik-split@example.com'
else:
    EMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend'
    EMAIL_USE_TLS = True
    EMAIL_PORT = 587
    EMAIL_HOST = 'smtp.gmail.com'
    EMAIL_HOST_USER = os.environ.get('EMAIL_HOST_USER')
    EMAIL_HOST_PASSWORD = os.environ.get('EMAIL_HOST_PASS')
    DEFAULT_FROM_EMAIL = os.environ.get('EMAIL_HOST_USER')
```

## Credits

------

### Code
The project used the code institutes template for Gitpod as a starting point and took a lot of boiler plate code from the Boutique Ado project.

There were a number of tutorials I followed and took inspiration from in the development of the project:

- Stripe Connect Set up - https://testdriven.io/blog/setting-up-stripe-connect-with-django/
- Stripe set up - https://testdriven.io/blog/django-stripe-tutorial/
- Peer to Peer payment app - https://www.twilio.com/blog/create-peer-to-peer-payment-app-laravel-stripe
- Django Social network app - https://realpython.com/django-social-network-1/ 

### Media

photos from pexels:
Photo by Helena Lopes from Pexels: https://www.pexels.com/photo/two-dinner-plates-on-square-brown-wooden-bar-table-693269/
